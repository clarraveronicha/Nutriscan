<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriScan - AI Food & Voice Assistant</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F3F4F6; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        
        /* Scanner Animation */
        .scan-line {
            width: 100%; height: 3px; background: #10B981; position: absolute; top: 0; left: 0;
            box-shadow: 0 0 15px #10B981; animation: scan 2s infinite linear; display: none;
        }
        @keyframes scan { 0% { top: 0%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 100%; opacity: 0; } }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .slide-up { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* Camera Grid */
        .camera-grid {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(to right, rgba(255,255,255,0.3) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255,255,255,0.3) 1px, transparent 1px);
            background-size: 33.3% 33.3%;
            pointer-events: none;
        }

        /* Toast Notification Animation */
        .toast-enter { animation: toastEnter 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
        .toast-exit { animation: toastExit 0.5s ease-in forwards; }
        @keyframes toastEnter { from { transform: translateY(-100%) scale(0.9); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        @keyframes toastExit { from { transform: translateY(0) scale(1); opacity: 1; } to { transform: translateY(-100%) scale(0.9); opacity: 0; } }

        .pulse-ring { animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite; }
        @keyframes pulse-ring { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        .voice-wave span { display: inline-block; width: 4px; height: 10px; background-color: #10B981; margin: 0 2px; border-radius: 2px; animation: wave 1s infinite ease-in-out; }
        .voice-wave span:nth-child(2) { animation-delay: 0.1s; } .voice-wave span:nth-child(3) { animation-delay: 0.2s; } .voice-wave span:nth-child(4) { animation-delay: 0.3s; } .voice-wave span:nth-child(5) { animation-delay: 0.4s; }
        @keyframes wave { 0%, 100% { height: 10px; } 50% { height: 25px; } }

        .input-group label { display: block; font-size: 0.75rem; font-weight: 600; color: #6B7280; margin-bottom: 0.25rem; }
        .input-group input, .input-group select { width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 1px solid #E5E7EB; background: #F9FAFB; transition: all 0.2s; }
        .input-group input:focus, .input-group select:focus { border-color: #10B981; outline: none; background: white; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        .checkbox-label { display: flex; align-items: center; gap: 8px; padding: 8px; background: #F9FAFB; border: 1px solid #E5E7EB; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .checkbox-label:hover { border-color: #10B981; }
        .checkbox-label input { accent-color: #10B981; width: 16px; height: 16px; }
        .checkbox-label input:checked + span { color: #10B981; font-weight: 600; }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex items-center justify-center p-0 sm:p-4 bg-gray-100">

    <div class="w-full h-screen sm:h-[800px] sm:max-w-md bg-white sm:rounded-3xl shadow-2xl overflow-hidden relative flex flex-col">
        
        <div id="toast-container" class="absolute top-4 left-4 right-4 z-[70] flex flex-col gap-2 pointer-events-none"></div>

        <header class="p-6 bg-white z-20 flex justify-between items-center border-b border-gray-100">
            <div>
                <h1 class="text-xl font-bold text-gray-900 tracking-tight flex items-center gap-3">
                    <img src="https://raw.githubusercontent.com/clarraveronicha/Nutriscan/refs/heads/main/logo%20nutri%20scan.jpeg" alt="Logo" class="w-8 h-8 rounded-lg object-cover shadow-sm">
                    <span>NutriScan<span class="text-emerald-500">.</span></span>
                </h1>
            </div>
            <button onclick="toggleMonika()" class="group flex items-center gap-2 bg-emerald-50 px-3 py-1.5 rounded-full hover:bg-emerald-100 transition-colors cursor-pointer active:scale-95">
                <span class="text-xs font-semibold text-emerald-700">Monika AI</span>
                <div class="w-2 h-2 rounded-full bg-emerald-500 group-hover:animate-ping"></div>
            </button>
        </header>

        <main id="main-content" class="flex-1 overflow-y-auto relative pb-24">
            
            <!-- VIEW 1: SCAN -->
            <section id="view-scan" class="p-6 h-full flex flex-col">
                <div id="welcome-msg" class="mb-4 fade-in">
                    <h2 class="text-2xl font-bold text-gray-800">Halo, <span id="user-greeting">Sobat Sehat</span>! üëã</h2>
                    <p class="text-gray-500 text-sm mt-1">Siap untuk hidup lebih sehat hari ini?</p>
                </div>

                <!-- Daily Tip Card -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-2xl mb-6 flex items-start gap-3 border border-blue-100 shadow-sm fade-in">
                    <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center shrink-0 mt-0.5">
                        <i class="fa-solid fa-lightbulb"></i>
                    </div>
                    <div>
                        <h4 class="text-xs font-bold text-blue-800 uppercase mb-1">Tips Hari Ini</h4>
                        <p id="daily-tip-text" class="text-xs text-blue-700 leading-relaxed">Minum air putih sebelum makan dapat membantu pencernaanmu.</p>
                    </div>
                </div>

                <div class="mb-6 fade-in" onclick="openSearch()">
                    <div class="bg-white border border-gray-200 text-gray-400 text-sm rounded-2xl py-4 px-5 flex items-center gap-3 shadow-sm cursor-pointer hover:border-emerald-300 transition-all active:scale-[0.99]">
                        <i class="fa-solid fa-magnifying-glass text-emerald-500"></i>
                        <span>Cari makanan manual...</span>
                    </div>
                </div>

                <div id="upload-state" class="flex-1 flex flex-col justify-center transition-all duration-300 -mt-4">
                    <div class="w-full space-y-4">
                        <button onclick="initCamera()" class="w-full py-8 rounded-3xl bg-emerald-50 border-2 border-dashed border-emerald-200 text-emerald-600 hover:bg-emerald-100 transition-all flex flex-col items-center justify-center gap-3 shadow-sm group">
                            <div class="w-14 h-14 bg-white rounded-full shadow-md flex items-center justify-center group-hover:scale-110 transition-transform">
                                <i class="fa-solid fa-camera text-2xl"></i>
                            </div>
                            <div class="text-center"><h3 class="font-bold text-base">Buka Kamera</h3><p class="text-[10px] opacity-70">Scan langsung</p></div>
                        </button>
                        <div class="relative flex py-1 items-center">
                            <div class="flex-grow border-t border-gray-200"></div><span class="flex-shrink-0 mx-4 text-gray-300 text-[10px] font-bold">ATAU</span><div class="flex-grow border-t border-gray-200"></div>
                        </div>
                        <button onclick="document.getElementById('file-input').click()" class="w-full py-4 rounded-xl border border-gray-200 text-gray-600 font-semibold hover:bg-gray-50 transition-colors flex items-center justify-center gap-2 text-sm">
                            <i class="fa-regular fa-image"></i> Ambil dari Galeri
                        </button>
                        <input type="file" id="file-input" class="hidden" accept="image/*" onchange="handleImageUpload(event)">
                    </div>
                </div>
            </section>

            <!-- CAMERA VIEW -->
            <div id="camera-state" class="hidden absolute inset-0 z-50 bg-black flex-col">
                <div class="camera-grid z-10"></div> <!-- Professional Grid Overlay -->
                <video id="camera-feed" autoplay playsinline class="w-full h-full object-cover"></video>
                <canvas id="camera-canvas" class="hidden"></canvas>
                <div class="absolute bottom-0 w-full p-8 flex justify-center items-center gap-8 bg-gradient-to-t from-black/80 to-transparent z-20">
                    <button onclick="stopCamera()" class="w-12 h-12 rounded-full bg-white/20 backdrop-blur text-white flex items-center justify-center"><i class="fa-solid fa-xmark"></i></button>
                    <button onclick="capturePhoto()" class="w-20 h-20 rounded-full border-4 border-white flex items-center justify-center active:scale-95 transition-transform"><div class="w-16 h-16 bg-white rounded-full"></div></button>
                    <div class="w-12 h-12"></div>
                </div>
            </div>

            <!-- ANALYSIS VIEW -->
            <div id="analysis-state" class="hidden absolute inset-0 z-40 bg-white flex-col h-full fade-in overflow-y-auto p-6">
                <button onclick="closeAnalysis()" class="absolute top-4 right-4 z-50 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500"><i class="fa-solid fa-times"></i></button>
                <div class="relative w-full h-56 rounded-2xl overflow-hidden shadow-lg mb-6 bg-gray-900 group shrink-0">
                    <img id="preview-image" src="" alt="Preview" class="w-full h-full object-cover opacity-90">
                    <div id="scanner-overlay" class="absolute inset-0 bg-black/50 z-10 hidden flex flex-col items-center justify-center backdrop-blur-[2px]">
                        <div class="scan-line"></div>
                        <div class="bg-white/90 backdrop-blur-md px-6 py-4 rounded-2xl flex flex-col items-center gap-3 shadow-2xl">
                            <i class="fa-solid fa-circle-notch fa-spin text-emerald-500 text-2xl"></i><span id="scan-status-text" class="text-sm font-semibold text-gray-800">Menganalisis...</span>
                        </div>
                    </div>
                </div>
                <div id="result-card" class="hidden">
                    <div class="bg-white rounded-2xl p-1 mb-4">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <div id="category-badge-container" class="mb-2"><span id="food-category" class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-[10px] font-bold uppercase bg-gray-100 text-gray-600">Makanan</span></div>
                                <h2 id="food-name" class="text-2xl font-bold text-gray-900 leading-tight">Nama Item</h2>
                                <button onclick="showManualInput()" class="mt-2 text-[10px] text-emerald-600 font-bold bg-emerald-50 px-2 py-1.5 rounded-lg hover:bg-emerald-100 transition-colors flex items-center gap-1 w-max"><i class="fa-solid fa-pen"></i> Koreksi</button>
                            </div>
                            <div class="text-right bg-emerald-50 px-4 py-3 rounded-xl border border-emerald-100"><span id="food-calories" class="block text-3xl font-bold text-emerald-600">0</span><span class="text-[10px] uppercase font-bold text-emerald-400">kkal</span></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-3 mb-6">
                        <div class="bg-orange-50 p-3 rounded-2xl border border-orange-100 text-center"><div class="text-[10px] text-orange-500 font-bold uppercase mb-1">Karbo</div><div id="food-carbs" class="text-lg font-bold text-gray-800">0g</div><div class="w-full bg-orange-200 h-1 rounded-full mt-2"><div id="bar-carbs" class="bg-orange-500 h-1 rounded-full" style="width:0%"></div></div></div>
                        <div class="bg-blue-50 p-3 rounded-2xl border border-blue-100 text-center"><div class="text-[10px] text-blue-500 font-bold uppercase mb-1">Protein</div><div id="food-protein" class="text-lg font-bold text-gray-800">0g</div><div class="w-full bg-blue-200 h-1 rounded-full mt-2"><div id="bar-protein" class="bg-blue-500 h-1 rounded-full" style="width:0%"></div></div></div>
                        <div class="bg-yellow-50 p-3 rounded-2xl border border-yellow-100 text-center"><div class="text-[10px] text-yellow-600 font-bold uppercase mb-1">Lemak</div><div id="food-fat" class="text-lg font-bold text-gray-800">0g</div><div class="w-full bg-yellow-200 h-1 rounded-full mt-2"><div id="bar-fat" class="bg-yellow-500 h-1 rounded-full" style="width:0%"></div></div></div>
                    </div>
                    <div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-4 text-white relative shadow-lg mb-6 cursor-pointer" onclick="playAudioTip()">
                        <div class="flex items-start gap-3"><div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center shrink-0"><i class="fa-solid fa-microphone-lines"></i></div><div><h4 class="text-xs font-bold text-emerald-100 uppercase mb-1">Saran Monika</h4><p id="food-tip" class="text-sm font-medium leading-relaxed opacity-95">...</p></div></div>
                    </div>
                    <div class="flex gap-3 pb-20">
                        <button onclick="saveAndReset()" class="flex-1 bg-gray-900 text-white py-3.5 rounded-xl font-semibold shadow-lg active:scale-95 transition-transform"><i class="fa-solid fa-check mr-2"></i> Simpan</button>
                        <button onclick="closeAnalysis()" class="px-4 py-3.5 rounded-xl border border-gray-200 text-gray-600 font-semibold active:bg-gray-50"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: ACTIVITIES -->
            <section id="view-activity" class="hidden p-6 h-full flex-col space-y-6 fade-in">
                <div class="bg-white rounded-3xl p-6 shadow-lg border border-gray-100">
                    <div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-500"><i class="fa-solid fa-fire-flame-curved"></i></div><h3 class="text-lg font-bold text-gray-800">Catat Aktivitas</h3></div>
                    <form onsubmit="saveActivity(event)" class="space-y-4">
                        <div class="input-group">
                            <label>Jenis Aktivitas</label>
                            <select id="activity-type" class="w-full" onchange="toggleDistanceInput()">
                                <option value="running" data-met="9.8" data-mode="dist">Lari (Running)</option>
                                <option value="walking" data-met="3.8" data-mode="dist">Jalan Santai</option>
                                <option value="cycling" data-met="7.5" data-mode="dist">Bersepeda</option>
                                <option value="swimming" data-met="8.0" data-mode="dist">Berenang</option>
                                <option value="badminton" data-met="5.5" data-mode="time">Bulu Tangkis</option>
                                <option value="football" data-met="7.0" data-mode="time">Sepak Bola</option>
                                <option value="basketball" data-met="6.5" data-mode="time">Basket</option>
                                <option value="aerobics" data-met="6.5" data-mode="time">Aerobik/Zumba</option>
                                <option value="gym" data-met="5.0" data-mode="time">Gym / Angkat Beban</option>
                                <option value="yoga" data-met="2.5" data-mode="time">Yoga</option>
                            </select>
                        </div>
                        <div id="distance-group" class="input-group transition-all">
                            <label>Jarak Tempuh (km)</label>
                            <input type="number" id="activity-distance" placeholder="0.0" step="0.1" min="0" oninput="calculateBurnEstimate('dist')">
                        </div>
                        <div class="input-group">
                            <label>Durasi (Menit)</label>
                            <input type="number" id="activity-duration" placeholder="30" min="1" max="300" value="30" oninput="calculateBurnEstimate('time')" required>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center border border-gray-100">
                            <span class="text-xs text-gray-500 font-semibold uppercase">Estimasi Bakar</span>
                            <div><span id="activity-burn-est" class="text-2xl font-bold text-orange-500">0</span> <span class="text-xs text-gray-400">kkal</span></div>
                        </div>
                        <button type="submit" class="w-full bg-orange-500 text-white py-3.5 rounded-xl font-bold shadow-lg active:scale-95 transition-transform"><i class="fa-solid fa-plus mr-2"></i> Tambah</button>
                    </form>
                </div>
                <div id="activity-list" class="space-y-3 pb-10"><div class="text-center py-8 text-gray-400 text-sm italic" id="empty-activity-msg">Belum ada aktivitas.</div></div>
            </section>

            <!-- VIEW 3: HISTORY -->
            <section id="view-history" class="hidden p-6 h-full flex-col space-y-4 fade-in">
                <div class="flex items-center justify-between mb-2"><h3 class="text-lg font-bold text-gray-800">Riwayat 30 Hari</h3><span class="text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full uppercase tracking-wider">Terbaru</span></div>
                <div id="history-list" class="space-y-4 pb-20 overflow-y-auto pr-1"></div>
            </section>

            <!-- VIEW 4: ANALYTICS -->
            <section id="view-analytics" class="hidden p-6 h-full flex-col space-y-6 fade-in">
                <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Ringkasan Hari Ini</h3>
                        <button onclick="resetDailyStats()" class="text-red-400 hover:text-red-600 text-xs font-bold border border-red-100 bg-red-50 px-3 py-1.5 rounded-lg transition-colors"><i class="fa-solid fa-rotate-left mr-1"></i> Reset</button>
                    </div>
                    <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-500">Target Harian</span><span class="text-sm font-bold text-gray-900"><span id="daily-cals">0</span> / <span id="target-cals">2000</span> kkal</span></div>
                    <div class="w-full bg-gray-100 h-4 rounded-full overflow-hidden mb-6"><div id="daily-progress" class="bg-gradient-to-r from-emerald-400 to-emerald-600 h-full rounded-full transition-all duration-1000" style="width: 0%"></div></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-50 rounded-xl p-4 text-center"><i class="fa-solid fa-fire text-orange-500 mb-2 text-xl"></i><div class="text-2xl font-bold text-gray-800" id="burned-cals">0</div><div class="text-[10px] text-gray-500">Aktivitas + BMR</div></div>
                        <div class="bg-gray-50 rounded-xl p-4 text-center"><i class="fa-solid fa-utensils text-blue-500 mb-2 text-xl"></i><div class="text-2xl font-bold text-gray-800" id="meals-count">0</div><div class="text-[10px] text-gray-500">Kali Makan</div></div>
                    </div>
                </div>
                <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Tren Mingguan</h3>
                    <div class="h-40 w-full"><canvas id="weeklyChart"></canvas></div>
                </div>
            </section>

            <!-- VIEW 5: PROFILE -->
            <section id="view-profile" class="hidden p-6 h-full flex-col space-y-6 fade-in">
                <div class="bg-white rounded-3xl p-6 shadow-lg border border-gray-100">
                    <div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600"><i class="fa-solid fa-user"></i></div><h3 class="text-lg font-bold text-gray-800">Profil & Data</h3></div>
                    <div class="bg-blue-50 rounded-xl p-4 mb-6 border border-blue-100 flex items-center justify-between">
                        <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center"><i class="fa-solid fa-bell"></i></div><div><h4 class="text-sm font-bold text-gray-800">Pengingat Makan</h4><p class="text-[10px] text-gray-500">07:00, 12:30, 19:00</p></div></div>
                        <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="toggle-notif" class="sr-only peer" onchange="toggleNotifications()"><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div></label>
                    </div>
                    <button onclick="testNotification()" class="w-full mb-6 border border-blue-200 text-blue-600 py-2 rounded-lg text-xs font-bold hover:bg-blue-50 transition-colors">Tes Notifikasi</button>
                    <form id="profile-form" onsubmit="saveProfile(event)" class="space-y-4">
                        <div class="input-group"><label>Nama</label><input type="text" id="input-name" placeholder="Nama Anda" required></div>
                        <div class="input-group"><label>Tujuan</label><div class="grid grid-cols-1 gap-2"><label class="checkbox-label justify-center"><input type="radio" name="goal" value="lose" class="peer"><span>Menurunkan Berat</span></label><label class="checkbox-label justify-center"><input type="radio" name="goal" value="maintain" checked class="peer"><span>Menjaga Berat</span></label><label class="checkbox-label justify-center"><input type="radio" name="goal" value="unsure" class="peer"><span>Masih Bingung</span></label></div></div>
                        <div class="input-group mt-4"><label>Gender</label><div class="grid grid-cols-2 gap-3"><label class="cursor-pointer"><input type="radio" name="gender" value="male" class="peer hidden" checked><div class="py-3 text-center rounded-xl border peer-checked:bg-emerald-500 peer-checked:text-white transition-all text-sm">Laki-laki</div></label><label class="cursor-pointer"><input type="radio" name="gender" value="female" class="peer hidden"><div class="py-3 text-center rounded-xl border peer-checked:bg-emerald-500 peer-checked:text-white transition-all text-sm">Perempuan</div></label></div></div>
                        <div class="grid grid-cols-2 gap-4"><div class="input-group"><label>Usia</label><input type="number" id="input-age" value="25"></div><div class="input-group"><label>Tinggi</label><input type="number" id="input-height" value="170"></div></div>
                        <div class="grid grid-cols-2 gap-4"><div class="input-group"><label>Berat (kg)</label><input type="number" id="input-weight" value="65"></div><div class="input-group"><label>Target (kg)</label><input type="number" id="input-target-weight" value="60"></div></div>
                        <button type="submit" class="w-full bg-gray-900 text-white py-3.5 rounded-xl font-bold shadow-lg active:scale-95 transition-transform">Simpan Profil</button>
                    </form>
                </div>
            </section>
        </main>

        <!-- MODALS -->
        <div id="search-modal" class="fixed inset-0 bg-white z-[60] hidden flex-col fade-in">
            <div class="p-6 border-b border-gray-100 flex gap-4 items-center bg-white shadow-sm">
                <button onclick="closeSearch()" class="text-gray-500 p-2"><i class="fa-solid fa-arrow-left text-xl"></i></button>
                <input type="text" id="global-search-input" class="w-full text-lg outline-none" placeholder="Ketik nama makanan..." oninput="handleSearch(this.value)" autocomplete="off">
            </div>
            <div class="flex-1 overflow-y-auto p-6 bg-gray-50"><div id="search-results" class="space-y-3"></div></div>
        </div>

        <div id="manual-input-modal" class="absolute inset-0 bg-black/60 z-[60] hidden flex-col justify-end fade-in backdrop-blur-sm">
            <div class="bg-white rounded-t-3xl p-6 min-h-[50%] slide-up relative shadow-2xl">
                <div class="flex justify-between items-center mb-6"><h3 class="text-lg font-bold text-gray-800">Koreksi Data</h3><button onclick="closeManualInput()" class="w-8 h-8 bg-gray-100 rounded-full flex justify-center items-center"><i class="fa-solid fa-times"></i></button></div>
                <form onsubmit="saveManualInput(event)" class="space-y-4">
                    <div class="input-group"><label>Nama Item</label><input type="text" id="edit-name" required list="available-foods" oninput="autoFillNutrition(this.value)"><datalist id="available-foods"></datalist></div>
                    <div class="input-group"><label>Kategori</label><select id="edit-category"><option value="food">Makanan</option><option value="drink">Minuman</option></select></div>
                    <div class="grid grid-cols-2 gap-4"><div class="input-group"><label>Kalori</label><input type="number" id="edit-cals"></div><div class="input-group"><label>Karbo</label><input type="number" id="edit-carbs"></div></div>
                    <div class="grid grid-cols-2 gap-4"><div class="input-group"><label>Protein</label><input type="number" id="edit-protein"></div><div class="input-group"><label>Lemak</label><input type="number" id="edit-fat"></div></div>
                    <button type="submit" class="w-full bg-emerald-600 text-white py-3.5 rounded-xl font-bold">Simpan</button>
                </form>
            </div>
        </div>

        <div id="monika-modal" class="absolute inset-0 bg-black/60 z-[70] hidden flex-col justify-end fade-in backdrop-blur-sm">
            <div class="bg-white rounded-t-3xl p-8 min-h-[40%] slide-up relative text-center">
                <button onclick="toggleMonika()" class="absolute top-4 right-4 w-8 h-8 bg-gray-100 rounded-full flex justify-center items-center"><i class="fa-solid fa-times"></i></button>
                <div class="w-20 h-20 bg-gradient-to-tr from-emerald-400 to-teal-500 rounded-full flex justify-center items-center shadow-lg mx-auto mb-6 pulse-ring"><i class="fa-solid fa-microphone text-3xl text-white"></i></div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Monika Mendengarkan...</h3>
                <div id="monika-status" class="h-8 flex justify-center items-center gap-1 mb-8"><div class="voice-wave hidden" id="voice-wave"><span></span><span></span><span></span><span></span><span></span></div><p id="monika-text" class="text-gray-500 text-sm">Tap mikrofon untuk mulai bicara</p></div>
                <button onmousedown="startListening()" onmouseup="stopListening()" ontouchstart="startListening()" ontouchend="stopListening()" class="w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg active:scale-95">Tahan untuk Bicara</button>
            </div>
        </div>

        <nav class="bg-white border-t border-gray-100 px-2 py-3 grid grid-cols-5 gap-0.5 z-[30] pb-safe">
            <button onclick="switchView('scan')" class="nav-btn flex flex-col items-center gap-1 text-emerald-600 transition-colors" id="nav-scan"><i class="fa-solid fa-camera text-lg"></i><span class="text-[9px] font-medium">Scan</span></button>
            <button onclick="switchView('activity')" class="nav-btn flex flex-col items-center gap-1 text-gray-400 transition-colors" id="nav-activity"><i class="fa-solid fa-person-running text-lg"></i><span class="text-[9px] font-medium">Aktivitas</span></button>
            <button onclick="switchView('history')" class="nav-btn flex flex-col items-center gap-1 text-gray-400 transition-colors" id="nav-history"><i class="fa-solid fa-clock-rotate-left text-lg"></i><span class="text-[9px] font-medium">Riwayat</span></button>
            <button onclick="switchView('analytics')" class="nav-btn flex flex-col items-center gap-1 text-gray-400 transition-colors" id="nav-analytics"><i class="fa-solid fa-chart-pie text-lg"></i><span class="text-[9px] font-medium">Analitik</span></button>
            <button onclick="switchView('profile')" class="nav-btn flex flex-col items-center gap-1 text-gray-400 transition-colors" id="nav-profile"><i class="fa-solid fa-user-gear text-lg"></i><span class="text-[9px] font-medium">Profil</span></button>
        </nav>

    </div>

    <script>
        // === NORMALIZED FOOD DATABASE (50+ Common Indonesian Items) ===
        const mockFoodDatabase = [
            // MAKANAN BERAT (NASI & MIE)
            { type: 'food', emoji: 'üçõ', keywords: ['nasi', 'goreng'], name: "Nasi Goreng", cals: 330, carbs: 45, prot: 12, fat: 10, tip: "Menu favorit! Kurangi minyak jika bisa." },
            { type: 'food', emoji: 'üçö', keywords: ['nasi', 'putih'], name: "Nasi Putih (1 Porsi)", cals: 204, carbs: 44, prot: 4, fat: 0, tip: "Sumber energi utama." },
            { type: 'food', emoji: 'üçö', keywords: ['nasi', 'uduk'], name: "Nasi Uduk", cals: 260, carbs: 40, prot: 5, fat: 12, tip: "Santan menambah kalori." },
            { type: 'food', emoji: 'üçö', keywords: ['nasi', 'kuning'], name: "Nasi Kuning", cals: 280, carbs: 42, prot: 5, fat: 13, tip: "Gurih dan lezat." },
            { type: 'food', emoji: 'üçõ', keywords: ['nasi', 'padang'], name: "Nasi Padang (Rendang)", cals: 660, carbs: 70, prot: 30, fat: 35, tip: "Tinggi kalori dan lemak." },
            { type: 'food', emoji: 'üçú', keywords: ['mie', 'goreng'], name: "Mie Goreng", cals: 380, carbs: 55, prot: 10, fat: 15, tip: "Karbohidrat tinggi." },
            { type: 'food', emoji: 'üçú', keywords: ['mie', 'ayam'], name: "Mie Ayam", cals: 420, carbs: 55, prot: 18, fat: 14, tip: "Tambahkan sayuran." },
            { type: 'food', emoji: 'üçú', keywords: ['bakso'], name: "Bakso Kuah", cals: 325, carbs: 30, prot: 20, fat: 12, tip: "Kuahnya segar." },
            { type: 'food', emoji: 'üç≤', keywords: ['soto', 'ayam'], name: "Soto Ayam", cals: 312, carbs: 20, prot: 22, fat: 15, tip: "Tanpa santan lebih sehat." },
            { type: 'food', emoji: 'ü•£', keywords: ['bubur', 'ayam'], name: "Bubur Ayam", cals: 250, carbs: 40, prot: 12, fat: 8, tip: "Sarapan ringan." },
            { type: 'food', emoji: 'ü•ó', keywords: ['gado', 'gado'], name: "Gado-Gado", cals: 320, carbs: 35, prot: 16, fat: 14, tip: "Banyak sayur dan serat." },
            { type: 'food', emoji: 'ü•ó', keywords: ['ketoprak'], name: "Ketoprak", cals: 400, carbs: 50, prot: 12, fat: 18, tip: "Saus kacang padat kalori." },

            // LAUK PAUK
            { type: 'food', emoji: 'üçó', keywords: ['ayam', 'goreng'], name: "Ayam Goreng (1 Ptg)", cals: 260, carbs: 8, prot: 24, fat: 18, tip: "Dada lebih rendah lemak." },
            { type: 'food', emoji: 'üçñ', keywords: ['rendang', 'sapi'], name: "Rendang Sapi (1 Ptg)", cals: 195, carbs: 5, prot: 22, fat: 11, tip: "Kaya protein." },
            { type: 'food', emoji: 'üç¢', keywords: ['sate', 'ayam'], name: "Sate Ayam (5 Tusuk)", cals: 220, carbs: 8, prot: 28, fat: 10, tip: "Protein baik." },
            { type: 'food', emoji: 'üêü', keywords: ['ikan', 'goreng'], name: "Ikan Goreng", cals: 200, carbs: 0, prot: 25, fat: 12, tip: "Sumber omega 3." },
            { type: 'food', emoji: 'ü•ö', keywords: ['telur', 'dadar'], name: "Telur Dadar", cals: 95, carbs: 1, prot: 7, fat: 7, tip: "Praktis dan bergizi." },
            { type: 'food', emoji: 'ü•ö', keywords: ['telur', 'rebus'], name: "Telur Rebus", cals: 75, carbs: 1, prot: 6, fat: 5, tip: "Paling sehat." },
            { type: 'food', emoji: 'ü•ú', keywords: ['tempe', 'goreng'], name: "Tempe Goreng (1 Pcs)", cals: 100, carbs: 8, prot: 7, fat: 6, tip: "Protein nabati terbaik." },
            { type: 'food', emoji: 'üçò', keywords: ['tahu', 'goreng'], name: "Tahu Goreng (1 Pcs)", cals: 80, carbs: 4, prot: 6, fat: 5, tip: "Ringan dan sehat." },

            // SNACK & BUAH
            { type: 'food', emoji: 'üçå', keywords: ['pisang', 'goreng'], name: "Pisang Goreng", cals: 140, carbs: 25, prot: 1, fat: 5, tip: "Camilan manis." },
            { type: 'food', emoji: 'ü•û', keywords: ['martabak'], name: "Martabak Manis (1 Potong)", cals: 270, carbs: 35, prot: 4, fat: 14, tip: "Tinggi gula dan lemak." },
            { type: 'food', emoji: 'ü•ë', keywords: ['alpukat'], name: "Alpukat (1 Buah)", cals: 320, carbs: 17, prot: 4, fat: 29, tip: "Lemak sehat." },
            { type: 'food', emoji: 'üçå', keywords: ['pisang'], name: "Pisang (1 Buah)", cals: 105, carbs: 27, prot: 1, fat: 0, tip: "Sumber energi instan." },
            { type: 'food', emoji: 'üçé', keywords: ['apel'], name: "Apel (1 Buah)", cals: 52, carbs: 14, prot: 0, fat: 0, tip: "Kaya serat." },
            { type: 'food', emoji: 'üçä', keywords: ['jeruk'], name: "Jeruk (1 Buah)", cals: 47, carbs: 12, prot: 1, fat: 0, tip: "Vitamin C." },

            // MINUMAN
            { type: 'drink', emoji: 'üíß', keywords: ['air', 'putih'], name: "Air Mineral", cals: 0, carbs: 0, prot: 0, fat: 0, tip: "Wajib minum 8 gelas/hari." },
            { type: 'drink', emoji: '‚òï', keywords: ['kopi', 'hitam'], name: "Kopi Hitam", cals: 2, carbs: 0, prot: 0, fat: 0, tip: "Tanpa gula lebih baik." },
            { type: 'drink', emoji: '‚òï', keywords: ['kopi', 'susu'], name: "Es Kopi Susu", cals: 180, carbs: 25, prot: 3, fat: 8, tip: "Perhatikan gulanya." },
            { type: 'drink', emoji: 'ü•§', keywords: ['teh', 'manis'], name: "Es Teh Manis", cals: 90, carbs: 22, prot: 0, fat: 0, tip: "Segar tapi manis." },
            { type: 'drink', emoji: 'üçµ', keywords: ['teh', 'tawar'], name: "Teh Tawar", cals: 0, carbs: 0, prot: 0, fat: 0, tip: "Nol kalori." },
            { type: 'drink', emoji: 'ü••', keywords: ['kelapa'], name: "Es Kelapa Muda", cals: 80, carbs: 10, prot: 1, fat: 3, tip: "Elektrolit alami." },
            { type: 'drink', emoji: 'ü•ë', keywords: ['jus', 'alpukat'], name: "Jus Alpukat", cals: 250, carbs: 25, prot: 3, fat: 15, tip: "Mengenyangkan." },
            { type: 'drink', emoji: 'üßã', keywords: ['boba'], name: "Boba Milk Tea", cals: 350, carbs: 50, prot: 2, fat: 12, tip: "Kalori tinggi." }
        ];

        // === STATE & TIPS ===
        const dailyTips = [
            "Minum air putih sebelum makan dapat membantu pencernaan.",
            "Kurangi gula tambahan untuk energi yang lebih stabil.",
            "Sayuran hijau kaya akan serat dan vitamin.",
            "Tidur cukup 7-8 jam membantu metabolisme tubuh.",
            "Jangan lewatkan sarapan untuk memulai hari dengan baik."
        ];

        let state = { currentCals: 850, burnedCals: 0, mealsToday: 2, lastScan: null, currentImage: null, view: 'scan', notificationsEnabled: false, triggeredNotifications: {}, activities: [], profile: { name: 'Sobat Sehat', gender: 'male', age: 25, height: 170, weight: 65, targetWeight: 60, goal: 'maintain', dailyTarget: 2000, bmr: 1600 } };
        let stream = null;
        let weeklyChartInstance = null;
        const historyData = []; 
        const views = {}; const navs = {};

        window.onload = function() {
            ['scan', 'history', 'analytics', 'profile', 'activity'].forEach(v => {
                views[v] = document.getElementById('view-' + v);
                navs[v] = document.getElementById('nav-' + v);
            });
            renderHistory();
            populateDatalist();
            loadDailyTip(); // Load Tip
            switchView('scan');
        };

        function loadDailyTip() {
            const tip = dailyTips[Math.floor(Math.random() * dailyTips.length)];
            const tipEl = document.getElementById('daily-tip-text');
            if(tipEl) tipEl.innerText = tip;
        }

        // --- NAVIGATION ---
        function switchView(viewName) {
            if(stream && viewName !== 'scan') stopCamera();
            closeAnalysis();
            Object.values(views).forEach(el => { if(el) { el.classList.add('hidden'); el.classList.remove('flex'); } });
            if(views[viewName]) { views[viewName].classList.remove('hidden'); views[viewName].classList.add('flex'); }
            Object.keys(navs).forEach(key => { if(navs[key]) { navs[key].classList.remove('text-emerald-600', 'text-orange-500'); navs[key].classList.add('text-gray-400'); } });
            if(navs[viewName]) { navs[viewName].classList.remove('text-gray-400'); navs[viewName].classList.add(viewName === 'activity' ? 'text-orange-500' : 'text-emerald-600'); }
            if (viewName === 'analytics') { updateAnalyticsUI(); initChart(); }
            if (viewName === 'profile') loadProfileUI();
            if (viewName === 'history') renderHistory();
            if (viewName === 'activity') toggleDistanceInput();
        }

        // --- CAMERA ---
        async function initCamera() { try { stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }); document.getElementById('camera-feed').srcObject = stream; document.getElementById('upload-state').classList.add('hidden'); document.getElementById('camera-state').classList.remove('hidden'); document.getElementById('camera-state').classList.add('flex'); } catch (err) { alert("Gagal akses kamera."); } }
        function stopCamera() { if (stream) { stream.getTracks().forEach(t => t.stop()); stream = null; } document.getElementById('camera-state').classList.add('hidden'); document.getElementById('camera-state').classList.remove('flex'); document.getElementById('upload-state').classList.remove('hidden'); }
        function capturePhoto() { const v = document.getElementById('camera-feed'); const c = document.getElementById('camera-canvas'); c.width = v.videoWidth; c.height = v.videoHeight; c.getContext('2d').drawImage(v, 0, 0); state.currentImage = c.toDataURL('image/jpeg'); stopCamera(); document.getElementById('preview-image').src = state.currentImage; startAnalysis('photo.jpg'); }
        function handleImageUpload(e) { const f = e.target.files[0]; if(!f)return; const r = new FileReader(); r.onload = function(evt) { document.getElementById('preview-image').src = evt.target.result; state.currentImage = evt.target.result; startAnalysis(f.name); }; r.readAsDataURL(f); }
        
        function startAnalysis(fn) { 
            document.getElementById('analysis-state').classList.remove('hidden'); document.getElementById('analysis-state').classList.add('flex'); 
            document.getElementById('scanner-overlay').classList.remove('hidden'); document.getElementById('scanner-overlay').classList.add('flex'); 
            document.getElementById('result-card').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('scanner-overlay').classList.add('hidden'); document.getElementById('scanner-overlay').classList.remove('flex');
                let matched = mockFoodDatabase.find(f => f.name.toLowerCase() === fn.toLowerCase());
                if (!matched) matched = mockFoodDatabase.find(f => f.keywords.some(k => fn.toLowerCase().includes(k))) || mockFoodDatabase[Math.floor(Math.random() * mockFoodDatabase.length)];
                state.lastScan = JSON.parse(JSON.stringify(matched)); renderScanResult(state.lastScan); speak(`Terdeteksi: ${matched.name}.`);
            }, 2000);
        }
        function closeAnalysis() { document.getElementById('analysis-state').classList.add('hidden'); document.getElementById('analysis-state').classList.remove('flex'); }
        function renderScanResult(d) {
            document.getElementById('food-name').innerText = d.name; document.getElementById('food-calories').innerText = d.cals;
            document.getElementById('food-carbs').innerText = d.carbs + 'g'; document.getElementById('food-protein').innerText = d.prot + 'g'; document.getElementById('food-fat').innerText = d.fat + 'g';
            document.getElementById('food-tip').innerText = `"${d.tip}"`;
            const badge = document.getElementById('food-category'); badge.innerText = d.type === 'drink' ? 'Minuman' : 'Makanan';
            badge.className = d.type === 'drink' ? "inline-flex items-center gap-1 px-2 py-1 rounded-full text-[10px] font-bold uppercase bg-blue-100 text-blue-600" : "inline-flex items-center gap-1 px-2 py-1 rounded-full text-[10px] font-bold uppercase bg-emerald-100 text-emerald-600";
            document.getElementById('result-card').classList.remove('hidden'); document.getElementById('result-card').classList.add('fade-in');
        }
        function saveAndReset() {
            if(state.lastScan) { state.currentCals += state.lastScan.cals; state.mealsToday++; const now = new Date(); historyData.unshift({ date: now.toISOString().split('T')[0], name: state.lastScan.name, cals: state.lastScan.cals, type: state.lastScan.type, emoji: state.lastScan.emoji, image: state.currentImage, time: `${now.getHours()}:${now.getMinutes()}` }); state.currentImage = null; }
            closeAnalysis(); document.getElementById('file-input').value = '';
        }

        // --- ACTIVITY ---
        function toggleDistanceInput() {
            const s = document.getElementById('activity-type'); const m = s.options[s.selectedIndex].getAttribute('data-mode');
            const g = document.getElementById('distance-group'); document.getElementById('activity-distance').value = '';
            if (m === 'dist') { g.classList.remove('hidden'); calculateBurnEstimate('time'); } else { g.classList.add('hidden'); calculateBurnEstimate('time'); }
        }
        function calculateBurnEstimate(src) {
            const sel = document.getElementById('activity-type'); const opt = sel.options[sel.selectedIndex];
            const type = sel.value; const met = parseFloat(opt.getAttribute('data-met')); const mode = opt.getAttribute('data-mode');
            const dIn = document.getElementById('activity-distance'); const tIn = document.getElementById('activity-duration');
            let dist = parseFloat(dIn.value)||0; let dur = parseFloat(tIn.value)||0; const w = state.profile.weight;
            let spd = 0; if (type==='running') spd=9; else if (type==='walking') spd=5; else if (type==='cycling') spd=18; else if (type==='swimming') spd=2.5;
            if(mode==='dist' && spd>0) { if(src==='dist' && dist>0) { dur=Math.round((dist/spd)*60); tIn.value=dur; } else if(src==='time' && dur>0) { dist=parseFloat(((dur/60)*spd).toFixed(1)); dIn.value=dist; } }
            let b = 0; if(mode==='dist' && dist>0) { let f=1; if(type==='running') f=1.03; else if(type==='walking') f=0.73; else if(type==='cycling') f=0.35; else if(type==='swimming') f=3; b=Math.round(w*dist*f); } else { b=Math.round(met*w*(dur/60)); }
            document.getElementById('activity-burn-est').innerText = b;
        }
        function saveActivity(e) { e.preventDefault(); const c = parseInt(document.getElementById('activity-burn-est').innerText); const n = document.getElementById('activity-type').options[document.getElementById('activity-type').selectedIndex].text.split('(')[0]; state.burnedCals += c; state.activities.push({name:n, cals:c, time:"Baru saja"}); renderActivityList(); speak(`Aktivitas ${n} disimpan.`); }
        function renderActivityList() { const l = document.getElementById('activity-list'); l.innerHTML = ''; state.activities.slice().reverse().forEach(a => { l.innerHTML += `<div class="bg-orange-50 p-3 rounded-xl flex justify-between items-center border border-orange-100"><div class="font-bold text-gray-800 text-sm">${a.name}</div><div class="text-orange-500 font-bold text-sm">-${a.cals} kkal</div></div>`; }); }

        // --- HISTORY ---
        function renderHistory() { const l = document.getElementById('history-list'); l.innerHTML = ''; historyData.forEach(i => { let img = i.image ? `<img src="${i.image}" class="w-10 h-10 rounded-full object-cover">` : `<div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-xl">${i.emoji||'üçΩÔ∏è'}</div>`; l.innerHTML += `<div class="bg-white p-3 rounded-2xl shadow-sm flex items-center gap-3 border border-gray-100">${img}<div><h4 class="font-bold text-sm">${i.name}</h4><p class="text-[10px] text-gray-400">${i.time}</p></div><div class="ml-auto font-bold text-emerald-600 text-sm">+${i.cals}</div></div>`; }); }

        // --- PROFILE ---
        function loadProfileUI() { document.getElementById('input-name').value = state.profile.name; document.getElementById('input-weight').value = state.profile.weight; document.getElementById('toggle-notif').checked = state.notificationsEnabled; }
        function saveProfile(e) { e.preventDefault(); state.profile.name = document.getElementById('input-name').value; state.profile.weight = parseInt(document.getElementById('input-weight').value); document.getElementById('user-greeting').innerText = state.profile.name; speak(`Profil disimpan.`); switchView('analytics'); }
        function toggleNotifications() { state.notificationsEnabled = document.getElementById('toggle-notif').checked; if(state.notificationsEnabled && Notification.permission !== "granted") Notification.requestPermission(); }
        function testNotification() { showToast("Halo " + state.profile.name, "Ini contoh notifikasi makan siang!"); }
        function showToast(t, m) { const c = document.getElementById('toast-container'); const d = document.createElement('div'); d.className = "bg-white p-4 rounded-xl shadow-lg border-l-4 border-emerald-500 toast-enter"; d.innerHTML = `<h4 class="font-bold text-sm">${t}</h4><p class="text-xs text-gray-500">${m}</p>`; c.appendChild(d); setTimeout(() => d.remove(), 4000); }

        // --- ANALYTICS ---
        function updateAnalyticsUI() { document.getElementById('daily-cals').innerText = state.currentCals; document.getElementById('burned-cals').innerText = 1600 + state.burnedCals; document.getElementById('meals-count').innerText = state.mealsToday; document.getElementById('daily-progress').style.width = Math.min((state.currentCals/2000)*100, 100) + '%'; }
        function resetDailyStats() { state.currentCals = 0; state.burnedCals = 0; state.mealsToday = 0; updateAnalyticsUI(); showToast("Reset Berhasil", "Data harian telah diatur ulang."); }
        function initChart() { const c = document.getElementById('weeklyChart').getContext('2d'); if(weeklyChartInstance) weeklyChartInstance.destroy(); weeklyChartInstance = new Chart(c, { type: 'bar', data: { labels: ['Sen','Sel','Rab','Kam','Jum','Sab','Min'], datasets: [{ data: [1800,2100,1950,2200,1750,2300,850], backgroundColor: '#10B981', borderRadius:4 }] }, options: { plugins:{legend:{display:false}}, scales:{x:{grid:{display:false}}, y:{beginAtZero:true}} } }); }

        // --- UTILS ---
        function openSearch() { document.getElementById('search-modal').classList.remove('hidden'); document.getElementById('search-modal').classList.add('flex'); }
        function closeSearch() { document.getElementById('search-modal').classList.add('hidden'); document.getElementById('search-modal').classList.remove('flex'); }
        function handleSearch(q) { const r = document.getElementById('search-results'); r.innerHTML = ''; if(q.length < 2) return; const m = mockFoodDatabase.filter(f => f.name.toLowerCase().includes(q.toLowerCase())).slice(0, 20); m.forEach(f => { r.innerHTML += `<div class="p-3 bg-white border rounded-xl flex justify-between items-center" onclick="selectSearch('${f.name}')"><span>${f.emoji} ${f.name}</span><span class="text-xs text-gray-400">${f.cals} kkal</span></div>`; }); }
        function selectSearch(n) { closeSearch(); startAnalysis(n); }
        function showManualInput() { document.getElementById('manual-input-modal').classList.remove('hidden'); document.getElementById('manual-input-modal').classList.add('flex'); document.getElementById('edit-name').value = state.lastScan.name; }
        function closeManualInput() { document.getElementById('manual-input-modal').classList.add('hidden'); document.getElementById('manual-input-modal').classList.remove('flex'); }
        function populateDatalist() { const l = document.getElementById('available-foods'); l.innerHTML = ''; mockFoodDatabase.slice(0,100).forEach(f => { let o = document.createElement('option'); o.value = f.name; l.appendChild(o); }); }
        function autoFillNutrition(v) { const m = mockFoodDatabase.find(f => f.name.toLowerCase() === v.toLowerCase()); if(m) { document.getElementById('edit-cals').value = m.cals; document.getElementById('edit-carbs').value = m.carbs; document.getElementById('edit-protein').value = m.prot; document.getElementById('edit-fat').value = m.fat; } }
        function saveManualInput(e) { e.preventDefault(); state.lastScan.name = document.getElementById('edit-name').value; state.lastScan.cals = parseInt(document.getElementById('edit-cals').value); renderScanResult(state.lastScan); closeManualInput(); }
        function speak(t) { window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(t); u.lang = 'id-ID'; u.rate = 1.1; window.speechSynthesis.speak(u); }
        function toggleMonika() { const m = document.getElementById('monika-modal'); if(m.classList.contains('hidden')) { m.classList.remove('hidden'); m.classList.add('flex'); speak("Halo!"); } else { m.classList.add('hidden'); m.classList.remove('flex'); } }
        function startListening() { document.getElementById('monika-text').innerText = "Mendengarkan..."; }
        function stopListening() { document.getElementById('monika-text').innerText = "Memproses..."; setTimeout(() => { speak("Fitur tanya jawab sedang dikembangkan."); }, 1000); }
    </script>
</body>
</html>
